<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BG Remover Pro</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        function BackgroundRemover() {
            const [originalImage, setOriginalImage] = useState(null);
            const [processedImage, setProcessedImage] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [dragActive, setDragActive] = useState(false);
            const [sensitivity, setSensitivity] = useState(45);
            const [showSettings, setShowSettings] = useState(false);
            const [zoom, setZoom] = useState(1);
            const [compareMode, setCompareMode] = useState(false);
            const [sliderPosition, setSliderPosition] = useState(50);
            const [bgColor, setBgColor] = useState('transparent');
            const fileInputRef = useRef(null);
            const canvasRef = useRef(null);

            const handleDrag = (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (e.type === "dragenter" || e.type === "dragover") {
                    setDragActive(true);
                } else if (e.type === "dragleave") {
                    setDragActive(false);
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                e.stopPropagation();
                setDragActive(false);
                
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    handleFile(e.dataTransfer.files[0]);
                }
            };

            const handleFile = (file) => {
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        setOriginalImage(event.target.result);
                        setProcessedImage(null);
                        setError('');
                    };
                    reader.readAsDataURL(file);
                } else {
                    setError('Please upload a valid image file');
                }
            };

            const handleImageUpload = (e) => {
                if (e.target.files[0]) {
                    handleFile(e.target.files[0]);
                }
            };

            const removeBackground = async (customThreshold = null) => {
                if (!originalImage) return;
                
                setLoading(true);
                setError('');
                
                try {
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    
                    await new Promise((resolve, reject) => {
                        img.onload = resolve;
                        img.onerror = reject;
                        img.src = originalImage;
                    });

                    const canvas = canvasRef.current;
                    const ctx = canvas.getContext('2d', { willReadFrequently: true });
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    ctx.drawImage(img, 0, 0);
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;

                    const corners = [
                        [0, 0],
                        [canvas.width - 1, 0],
                        [0, canvas.height - 1],
                        [canvas.width - 1, canvas.height - 1]
                    ];
                    
                    let bgR = 0, bgG = 0, bgB = 0;
                    corners.forEach(([x, y]) => {
                        const idx = (y * canvas.width + x) * 4;
                        bgR += data[idx];
                        bgG += data[idx + 1];
                        bgB += data[idx + 2];
                    });
                    bgR /= 4; bgG /= 4; bgB /= 4;

                    const threshold = customThreshold || sensitivity;
                    
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        
                        const diff = Math.abs(r - bgR) + Math.abs(g - bgG) + Math.abs(b - bgB);
                        
                        if (diff < threshold) {
                            data[i + 3] = 0;
                        } else if (diff < threshold * 1.5) {
                            data[i + 3] = Math.floor((diff - threshold) / (threshold * 0.5) * 255);
                        }
                    }

                    ctx.putImageData(imageData, 0, 0);
                    setProcessedImage(canvas.toDataURL('image/png'));
                } catch (err) {
                    setError('Failed to process image. Please try another image.');
                } finally {
                    setLoading(false);
                }
            };

            const downloadImage = () => {
                if (!processedImage) return;
                
                const link = document.createElement('a');
                link.href = processedImage;
                link.download = `bg-removed-${Date.now()}.png`;
                link.click();
            };

            const reset = () => {
                setOriginalImage(null);
                setProcessedImage(null);
                setError('');
                setSensitivity(45);
                setZoom(1);
                setCompareMode(false);
                setBgColor('transparent');
                if (fileInputRef.current) fileInputRef.current.value = '';
            };

            useEffect(() => {
                if (processedImage && sensitivity) {
                    const timeoutId = setTimeout(() => {
                        removeBackground(sensitivity);
                    }, 300);
                    return () => clearTimeout(timeoutId);
                }
            }, [sensitivity]);

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
                    <nav className="bg-black bg-opacity-30 backdrop-blur-lg border-b border-white border-opacity-10">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
                                        <span className="text-2xl">‚ú®</span>
                                    </div>
                                    <span className="text-2xl font-bold text-white">BG Remover Pro</span>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                        {!originalImage && (
                            <div className="text-center mb-12">
                                <div className="inline-flex items-center gap-2 px-4 py-2 bg-purple-500 bg-opacity-20 border border-purple-500 border-opacity-30 rounded-full text-purple-300 text-sm mb-6">
                                    <span>‚ö°</span>
                                    <span>AI-Powered Background Removal</span>
                                </div>
                                <h1 className="text-6xl font-bold text-white mb-4 leading-tight">
                                    Remove Image<br/>Backgrounds in Seconds
                                </h1>
                                <p className="text-xl text-gray-300 mb-8 max-w-2xl mx-auto">
                                    Professional background removal powered by advanced algorithms. Perfect for e-commerce, marketing, and design projects.
                                </p>
                            </div>
                        )}

                        <div className="bg-white bg-opacity-5 backdrop-blur-xl rounded-3xl shadow-2xl border border-white border-opacity-10 overflow-hidden">
                            {!originalImage ? (
                                <div className="p-8 md:p-12">
                                    <div 
                                        onDragEnter={handleDrag}
                                        onDragLeave={handleDrag}
                                        onDragOver={handleDrag}
                                        onDrop={handleDrop}
                                        onClick={() => fileInputRef.current?.click()}
                                        className={`border-4 border-dashed rounded-2xl p-16 md:p-24 text-center cursor-pointer transition-all duration-300 ${
                                            dragActive 
                                                ? 'border-purple-400 bg-purple-500 bg-opacity-10 scale-105' 
                                                : 'border-gray-600 hover:border-purple-500 hover:bg-purple-500 hover:bg-opacity-5'
                                        }`}
                                    >
                                        <div className="text-8xl mb-6">üì§</div>
                                        <p className="text-2xl font-semibold text-white mb-3">
                                            {dragActive ? 'Drop your image here' : 'Click or drag image to upload'}
                                        </p>
                                        <p className="text-gray-400 text-lg mb-4">PNG, JPG, JPEG supported</p>
                                        <p className="text-gray-500 text-sm">Maximum file size: 10MB</p>
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            accept="image/*"
                                            onChange={handleImageUpload}
                                            className="hidden"
                                        />
                                    </div>

                                    <div className="grid md:grid-cols-3 gap-6 mt-12">
                                        <div className="text-center p-6 rounded-xl bg-white bg-opacity-5 border border-white border-opacity-10">
                                            <div className="text-5xl mb-4">‚ö°</div>
                                            <h3 className="text-white font-semibold mb-2">Lightning Fast</h3>
                                            <p className="text-gray-400 text-sm">Process images in seconds</p>
                                        </div>
                                        <div className="text-center p-6 rounded-xl bg-white bg-opacity-5 border border-white border-opacity-10">
                                            <div className="text-5xl mb-4">üé®</div>
                                            <h3 className="text-white font-semibold mb-2">High Quality</h3>
                                            <p className="text-gray-400 text-sm">Transparent PNG output</p>
                                        </div>
                                        <div className="text-center p-6 rounded-xl bg-white bg-opacity-5 border border-white border-opacity-10">
                                            <div className="text-5xl mb-4">‚ú®</div>
                                            <h3 className="text-white font-semibold mb-2">100% Free</h3>
                                            <p className="text-gray-400 text-sm">No watermarks, unlimited use</p>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="p-8">
                                    <div className="flex justify-between items-center mb-8">
                                        <h2 className="text-3xl font-bold text-white">Your Image</h2>
                                        <button
                                            onClick={reset}
                                            className="flex items-center gap-2 px-5 py-2.5 bg-white bg-opacity-10 hover:bg-opacity-20 text-white rounded-xl transition-all border border-white border-opacity-20"
                                        >
                                            <span>‚ùå</span>
                                            Upload New
                                        </button>
                                    </div>

                                    <div className="grid lg:grid-cols-2 gap-8 mb-8">
                                        <div>
                                            <div className="flex items-center justify-between mb-4">
                                                <div className="flex items-center gap-2">
                                                    <div className="w-2 h-2 bg-gray-400 rounded-full"></div>
                                                    <h3 className="font-semibold text-gray-300 text-lg">Original Image</h3>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => setZoom(Math.max(0.5, zoom - 0.25))}
                                                        className="px-3 py-2 bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg transition-all text-white"
                                                        title="Zoom Out"
                                                    >
                                                        üîç-
                                                    </button>
                                                    <button
                                                        onClick={() => setZoom(Math.min(3, zoom + 0.25))}
                                                        className="px-3 py-2 bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg transition-all text-white"
                                                        title="Zoom In"
                                                    >
                                                        üîç+
                                                    </button>
                                                    <button
                                                        onClick={() => setZoom(1)}
                                                        className="px-3 py-2 bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg transition-all text-white"
                                                        title="Reset Zoom"
                                                    >
                                                        üîÑ
                                                    </button>
                                                </div>
                                            </div>
                                            <div className="border-2 border-white border-opacity-20 rounded-2xl overflow-hidden bg-white bg-opacity-5 shadow-xl">
                                                <div className="overflow-auto max-h-[500px]">
                                                    <img 
                                                        src={originalImage} 
                                                        alt="Original" 
                                                        style={{transform: `scale(${zoom})`, transformOrigin: 'top left'}}
                                                        className="w-full h-auto transition-transform"
                                                    />
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <div className="flex items-center justify-between mb-4">
                                                <div className="flex items-center gap-2">
                                                    <div className="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                                                    <h3 className="font-semibold text-gray-300 text-lg">Background Removed</h3>
                                                </div>
                                                {processedImage && (
                                                    <button
                                                        onClick={() => setCompareMode(!compareMode)}
                                                        className="px-3 py-1.5 bg-purple-500 bg-opacity-20 hover:bg-opacity-30 text-purple-300 rounded-lg transition-all text-sm"
                                                    >
                                                        {compareMode ? 'Exit Compare' : '‚öñÔ∏è Compare'}
                                                    </button>
                                                )}
                                            </div>
                                            <div className="border-2 border-white border-opacity-20 rounded-2xl overflow-hidden shadow-xl relative" 
                                                style={{
                                                    backgroundColor: bgColor === 'transparent' ? 'transparent' : bgColor,
                                                    backgroundImage: bgColor === 'transparent' ? 'repeating-conic-gradient(rgba(255,255,255,0.05) 0% 25%, transparent 0% 50%) 50% / 20px 20px' : 'none'
                                                }}>
                                                {processedImage ? (
                                                    compareMode ? (
                                                        <div className="relative overflow-hidden">
                                                            <img src={originalImage} alt="Original" className="w-full h-auto" style={{transform: `scale(${zoom})`}} />
                                                            <div 
                                                                className="absolute top-0 left-0 h-full overflow-hidden"
                                                                style={{width: `${sliderPosition}%`}}
                                                            >
                                                                <img src={processedImage} alt="Processed" className="w-full h-auto" style={{transform: `scale(${zoom})`}} />
                                                            </div>
                                                            <input
                                                                type="range"
                                                                min="0"
                                                                max="100"
                                                                value={sliderPosition}
                                                                onChange={(e) => setSliderPosition(e.target.value)}
                                                                className="absolute top-0 left-0 w-full h-full opacity-0 cursor-ew-resize"
                                                            />
                                                            <div 
                                                                className="absolute top-0 bottom-0 w-1 bg-white shadow-lg pointer-events-none"
                                                                style={{left: `${sliderPosition}%`}}
                                                            >
                                                                <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-white rounded-full shadow-xl flex items-center justify-center text-xl">
                                                                    ‚¨ç‚¨å
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <div className="overflow-auto max-h-[500px]">
                                                            <img 
                                                                src={processedImage} 
                                                                alt="Processed" 
                                                                style={{transform: `scale(${zoom})`, transformOrigin: 'top left'}}
                                                                className="w-full h-auto transition-transform"
                                                            />
                                                        </div>
                                                    )
                                                ) : (
                                                    <div className="w-full aspect-square flex items-center justify-center bg-white bg-opacity-5">
                                                        <p className="text-gray-400 text-lg">Processed image will appear here</p>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>

                                    {error && (
                                        <div className="mb-6 p-4 bg-red-500 bg-opacity-20 border border-red-500 border-opacity-50 rounded-xl text-red-300">
                                            {error}
                                        </div>
                                    )}

                                    {processedImage && (
                                        <div className="mb-6 p-6 bg-white bg-opacity-5 rounded-xl border border-white border-opacity-10">
                                            <button
                                                onClick={() => setShowSettings(!showSettings)}
                                                className="flex items-center gap-2 text-white font-semibold mb-4 hover:text-purple-300 transition-colors w-full"
                                            >
                                                <span>‚öôÔ∏è</span>
                                                <span>Advanced Settings</span>
                                                <span className="ml-auto">{showSettings ? '‚ñ≤' : '‚ñº'}</span>
                                            </button>
                                            
                                            {showSettings && (
                                                <div className="space-y-6">
                                                    <div>
                                                        <label className="flex items-center justify-between text-gray-300 mb-3">
                                                            <span>Background Removal Sensitivity</span>
                                                            <span className="text-purple-400 font-semibold">{sensitivity}</span>
                                                        </label>
                                                        <input
                                                            type="range"
                                                            min="20"
                                                            max="100"
                                                            value={sensitivity}
                                                            onChange={(e) => setSensitivity(Number(e.target.value))}
                                                            className="w-full h-2 bg-white bg-opacity-10 rounded-lg appearance-none cursor-pointer"
                                                            style={{accentColor: '#a855f7'}}
                                                        />
                                                        <div className="flex justify-between text-xs text-gray-500 mt-1">
                                                            <span>Less Aggressive</span>
                                                            <span>More Aggressive</span>
                                                        </div>
                                                    </div>

                                                    <div>
                                                        <label className="text-gray-300 mb-3 block">Preview Background Color</label>
                                                        <div className="flex gap-3 flex-wrap">
                                                            <button
                                                                onClick={() => setBgColor('transparent')}
                                                                className={`w-12 h-12 rounded-lg border-2 transition-all ${bgColor === 'transparent' ? 'border-purple-400 scale-110' : 'border-white border-opacity-20'}`}
                                                                style={{backgroundImage: 'repeating-conic-gradient(rgba(255,255,255,0.2) 0% 25%, rgba(100,100,100,0.2) 0% 50%) 50% / 10px 10px'}}
                                                                title="Transparent"
                                                            />
                                                            {['#FFFFFF', '#000000', '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF'].map(color => (
                                                                <button
                                                                    key={color}
                                                                    onClick={() => setBgColor(color)}
                                                                    className={`w-12 h-12 rounded-lg border-2 transition-all ${bgColor === color ? 'border-purple-400 scale-110' : 'border-white border-opacity-20'}`}
                                                                    style={{backgroundColor: color}}
                                                                    title={color}
                                                                />
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    <div className="flex gap-4">
                                        {!processedImage ? (
                                            <button
                                                onClick={removeBackground}
                                                disabled={loading}
                                                className="flex-1 flex items-center justify-center gap-3 px-8 py-5 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-semibold hover:from-purple-700 hover:to-pink-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed text-lg shadow-xl"
                                            >
                                                {loading ? (
                                                    <>
                                                        <span className="animate-spin">‚è≥</span>
                                                        Processing Image...
                                                    </>
                                                ) : (
                                                    <>
                                                        <span>‚ú®</span>
                                                        Remove Background
                                                    </>
                                                )}
                                            </button>
                                        ) : (
                                            <>
                                                <button
                                                    onClick={removeBackground}
                                                    disabled={loading}
                                                    className="flex-1 flex items-center justify-center gap-2 px-6 py-5 bg-white bg-opacity-10 hover:bg-opacity-20 text-white rounded-xl font-semibold transition-all border border-white border-opacity-20"
                                                >
                                                    Process Again
                                                </button>
                                                <button
                                                    onClick={downloadImage}
                                                    className="flex-1 flex items-center justify-center gap-3 px-8 py-5 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-semibold hover:from-green-600 hover:to-emerald-700 transition-all text-lg shadow-xl"
                                                >
                                                    <span>‚¨áÔ∏è</span>
                                                    Download PNG
                                                </button>
                                            </>
                                        )}
                                    </div>
                                </div>
                            )}

                            <canvas ref={canvasRef} style={{display: 'none'}} />
                        </div>

                        <div className="mt-16 text-center">
                            <p className="text-gray-400 mb-4">
                                ¬© 2024 BG Remover Pro. All rights reserved.
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BackgroundRemover />);
    </script>
</body>
</html>
